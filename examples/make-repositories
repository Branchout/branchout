#!/bin/bash

makeBase() {
  rm -rf ${1}
  mkdir ${1}
  pushd ${1}
  git init
  git config user.email "someone@example.com"; 
  git config user.name "hopefully_not_real"; 

  echo "# ${each}" > README.md; 
  echo "frog-aleph
frog-gemel
toad-aleph" > Branchoutprojects
  echo "BRANCHOUT_NAME=${1}" > Branchoutfile
  git add README.md Branchoutprojects Branchoutfile;
  git commit -a -m"Initial commit"; 
  
  popd
}

makeTemplates() {
  pushd ${1}
  mkdir -p Branchouttemplates/maven
  echo '<?xml version="1.0" encoding="UTF-8"?>
<settings xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.1.0 http://maven.apache.org/xsd/settings-1.1.0.xsd" xmlns="http://maven.apache.org/SETTINGS/1.1.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <localRepository>${user.home}/branchout/#{BRANCHOUT_NAME}/maven/repository</localRepository>

  <servers>
    <server>
      <username>#{BRANCHOUT_MAVEN_USER}</username>
      <password>#{BRANCHOUT_MAVEN_PASSWORD}</password>
      <id>branchout-maven</id>
    </server>   
  </servers>

  <mirrors>
    <mirror>
      <mirrorOf>*</mirrorOf>
      <name>branchout-maven</name>
      <url>#{BRANCHOUT_MAVEN_MIRROR}</url>
      <id>branchout-maven</id>
    </mirror>
  </mirrors>

  <pluginGroups>
    <pluginGroup>net.stickycode.plugins</pluginGroup>
  </pluginGroups>
  
</settings>
' > Branchouttemplates/maven/settings.xml
  git add Branchouttemplates
  git commit -a -m'templates'
  popd
}

makeLegacyBase() {
  rm -rf ${1}
  mkdir ${1}
  pushd ${1}
  git init
  git config user.email "someone@example.com"; 
  git config user.name "hopefully_not_real"; 

  echo "# ${each}" > README.md; 
  echo "frog-aleph
frog-gemel
toad-aleph" > .projects
  echo "BRANCHOUT_NAME=${1}" > .branchout
  git add README.md .projects .branchout;
  git commit -a -m"Initial commit"; 
  
  popd
}

makeGroup() {
  rm -rf ${1}
  mkdir ${1}
  pushd ${1}
  git init
  git config user.email "someone@example.com"; 
  git config user.name "hopefully_not_real"; 

  echo "# ${each}" >> README.md; 
  git add README.md; 
  git  commit -a -m"Initial commit"; 
  
  popd
}

makeProject() {
    rm -rf ${each}-${counter}
    mkdir ${each}-${counter}; 
    pushd ${each}-${counter}; 

    git init; 
    git config user.email "someone@example.com"; 
    git config user.name "hopefully_not_real"; 

    echo "# ${each}-${counter}" >> README.md; 
    git add README.md; 
    git  commit -a -m"Initial commit"; 

    echo "# ${each}-${counter}" >> README.md; 
    git commit -a -m"step 2";
    git tag -a step-2 -m "step 2"

    echo "# ${each}-${counter}" >> README.md; 
    git  commit -a -m"step 3";
 
    git checkout -b feature-${counter}; 
    echo "* feature ${counter}" >> README.md; 
    git commit -a -m "Adding feature ${counter}";
    git checkout master
    popd; 
}

mkdir -p target/repositories
cd target/repositories

for each in frog toad; do 
  makeGroup ${each}
  for counter in aleph bet gemel; do 
    makeProject
  done; 
done
for each in snake fox; do 
  for counter in aleph bet gemel; do 
    makeProject
  done; 
done
for animal in goat sheep; do 
  for counter in aleph bet gemel; do 
    each=prefix-${animal}
    makeProject
  done; 
done
makeGroup sheep
makeGroup rabbit
each=rabbit counter=aleph makeProject
each=lion counter=aleph makeProject

makeBase base
makeBase ghbase.git
makeLegacyBase legacy

makeBase templates
makeTemplates templates



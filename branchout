#!/bin/bash

function usage() {
    test -n "${1}" && echo "${1}" && echo
    echo "branchout: a tool for managing multi-repo projects
    
    status: show the list of known projects and their current state
    "
  return 1
}

function branchoutDirectory() {
  BRANCHOUT_DIRECTORY="${PWD}"
  while test ! -f "${BRANCHOUT_DIRECTORY}/.branchout"; do
    BRANCHOUT_DIRECTORY=$(dirname "${BRANCHOUT_DIRECTORY}")
    test "${BRANCHOUT_DIRECTORY}" = '/' && echo ".branchout configuration not found in parent hierarchy, run branchout init" && exit 1
  done
  export BRANCHOUT_DIRECTORY
}

function loadBranchout() {
  branchoutDirectory
  
  # shellcheck source=/dev/null
  source "${BRANCHOUT_DIRECTORY}/.branchout"
  
  test -z "${BRANCHOUT_NAME}" && usage "Branchout name not defined in .branchout, run branchout init"
}

function branchoutStatus() {
  loadBranchout  
}


case "$1" in
  status)
    branchoutStatus
    ;;
  *)
    usage
    ;;
esac
